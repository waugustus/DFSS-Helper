# 东方时尚驾校真人教练查询预约工具

本工具旨在帮助东方时尚预约计时班的学员们避开AI机器人教练车（AI机器人车一人一车，真人教练车两人一车）

## 基本功能

1. 扫描可约天数内所有的真人教练
2. 查询指定日期内的所有真人教练，如有需要也可直接随机从中选择一个教练进行预约
3. 全自动获取Cookies以及登录信息，并识别验证码
4. 定时模块，在指定日期早上6点按时抢号

---

## 使用前提

1. 东方时尚驾校账号密码
2. 注册baidu开发者，并获取appId与appSecret参考https://console.bce.baidu.com/ai/
3. selenium驱动安装，默认使用safari，可自行在dfss_utils.py中修改

---

## 常量信息设置

直接修改config.json中的数据即可，数据仅供本地读取调用，不传至互联网

---

## 获取Cookies以及验证码

经抓包发现，东方时尚的Cookies是由cnzz.cn提供的页面动态刷新，传统爬虫无法获取Cookies内容，本工具通过 __selenium__ 调用浏览器获取Cookies

对于图片验证码，由于东方时尚的验证码噪点较少，故直接调用baidu文字识别接口进行识别，成功率大概75%左右，如遇到验证码错误，请多尝试几次

---

## 定时抢号

由于本工具使用了Selenium调用浏览器获取Cookies，故可能不适合无界面服务器定时方式（crontab），本工具采用python的APScheduler进行定时脚本设置。

虽然东方时尚每天0点放号，但实际抢号时间为6点以后，故本工具定时模块自动设置时间为6点。

---

## 基本用法

```
$ python main.py help
[*] Usage: python main.py actions [params]
            [*] Actions:
                help 获取帮助列表
                scan 扫描模式，从本日扫描指定天数的数据（数据由课程类型决定：散段7天，桩训及科三36天）
                query 查询模式，查询指定日期的可用非AI车辆列表
            [*] Params:
                -w 查询结束后直接随机从结果中选择教练进行预约
                -l 指定课程类型ID，ID对应关系如下：
                    001: 散段
                    002: 桩训
                    003: 科三场内
                    004: 综合训练
                    005: 考前路训
                -t 课程时间ID，ID对应关系如下：
                    1: 8:00-12:00
                    2: 12:00-16:00
                    3: 16:00-20:00
                -d 查询日期，满足YYYY-MM-DD格式
                -s 定时执行命令，日期满足YYYY-MM-DD格式
```

## Example

1. 扫描7日内所有散段8:00-12:00可约的真人教练 （散段最多可约7日）
   > $ python main.py scan -l 001 -t 1 
2. 查询2021年3月26日所有散段12:00-16:00可约真人教练
   > $ python main.py query -l 001 -t 2 -d 2021-03-26
3. 定时2021年4月1日6点抢2021年4月7日的16:00-20:00的号
   > $ python main.py query -l 001 -t 2 -d 2021-04-07 -s 2021-04-01 
